<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>三商美邦 :: 投資型商品</title>
<link rel="stylesheet" href="./css/jquery-ui.theme.min.css">
<link rel="stylesheet" href="./css/jquery-ui.min.css">
<style type="text/css">
body {
    margin: 0;
    padding: 0;
}
.redbold {
	font-weight: bold;
	color: #E8012D;
}
.pinkbold {
	font-weight: bold;
	color: #cf00cf;
}
.blackbold {
	font-weight: bold;
	color: #000;
}
.loginForm{
	position:relative;
	color:#E8012D;
	background-color:#fafafa;
	margin:18px;
    border-radius: 15px;
	border: 2px solid #CCCCCC;
    padding: 5px;
	width:200px
	}
/* The Modal (background) */
.modal {
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 40px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow:scroll;
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
	font-size:15px;
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
}
.innerTxt{
	margin-top:0;
	margin-bottom:0;
	margin-left:30px;
	margin-right:30px;
	}

a {
	font-size: 16px;
	color: #666;
}
a:link {
	text-decoration: underline;
}
a:visited {
	text-decoration: underline;
	color: #666;
}
a:hover {
	text-decoration: none;
}
a:active {
	text-decoration: underline;
}
.hintBox{
	color: #F00;
	padding:10px;
	}
</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td height="768" align="center" valign="middle"><table border="0" align="center" cellpadding="0" cellspacing="0">
      <tr>
        <td align="right" valign="middle"><img src="images/loginTitle.jpg" width="450" height="384" alt=""/></td>
        <td align="center">
        <div id="updateAPP" class="loginForm" style="display:none">
    <table border="0" cellspacing="6" cellpadding="0">
      <tr>
        <td colspan="2" align="center" class="redbold"><strong>APP已經有新版本!</strong>
          <label for="password3"></label></td>
      </tr>
      <tr>
        <td align="center"><input type="submit" name="updateNoBtn" id="updateNoBtn" value=" 下次更新 "></td>
        <td align="center"><input type="button" name="updateNowBtn" id="updateNowBtn" value=" 立即更新 " class="pinkbold"></td>
      </tr>
    </table>
        </div>
        <form action="/" id="loginform">
            <div id="formDiv" class="loginForm" ><table border="0" cellspacing="6" cellpadding="0">
              <tr>
                <td class="redbold">帳號</td>
                <td><label for="account"></label>
                  <input name="account" type="text" id="account" size="15" maxlength="15" onBlur="check(this)"></td>
              </tr>
              <tr>
                <td class="redbold">密碼</td>
                <td><label for="password"></label>
                  <input name="password" type="password" id="password" size="15" maxlength="15" onBlur="check(this)" autocomplete="off"></td>
              </tr>
              <tr>
                <td align="center"><input name="identity" type="hidden" id="identity" value="">
                  <input name="keyValue" type="hidden" id="keyValue" value=""></td>
                <td align="center"><input type="submit" name="send" id="send" value="  送  出 "></td>
              </tr>
          </table></div>
            <div id="formDiv2" class="loginForm" style="display:none">
              <table border="0" cellspacing="6" cellpadding="0">
                <tr>
                  <td class="redbold">帳號</td>
                  <td id="tempid" class="blackbold"></td>
                </tr>
                <tr>
                  <td class="redbold">密碼</td>
                  <td><label for="password2"></label>
                    <input name="password2" type="password" id="password2" size="15" maxlength="15" onBlur="check(this)" autocomplete="off"></td>
                </tr>
                <tr>
                  <td align="center">&nbsp;</td>
                  <td align="center"><input type="submit" name="send2" id="send2" value=" 送出 ">
                    <input type="button" name="logoutBtn" id="logoutBtn" value=" 登出"></td>
                </tr>
              </table>
            </div>
            <div id="errorLogin" class="hintBox" style="display:none">
  您的帳號或密碼輸入錯誤，請再試一次!
</div><div id="errorConnect" class="hintBox" style="display:none">
  網路未連線!
</div><div id="errorInput" class="hintBox" style="display:none">
  帳號密碼不能有特殊符號!
</div>
<div id="changePass" class="hintBox" style="display:none">
  密碼超過90天了，請變更密碼!
</div><div id="errorLogin2" class="hintBox" style="display:none">
  您的密碼輸入錯誤，請再試一次!
</div>
        </form></td>
      </tr>
    </table>
    <p><br><br><a href="mailto:90622G@mail.mli.com.tw?subject=[投資型商品APP]%20問題回報&body=問題描述：">回報安全性問題</a></p></td>
  </tr>
</table>
<div id="myModal" class="modal" style="display:none">
  <!-- Modal content -->
  <div class="modal-content">
    <p align="center"><strong>三商美邦人壽保險股份有限公司<br>
      履行個人資料保護法蒐集、處理及利用個人資料告知書</strong></p>
    三商美邦人壽保險股份有限公司（以下稱本公司）現在或將來蒐集、處理或利用 台端之個人資料，依據我國個人資料保護相關法令規定，告知下列事項，請  詳閱：<br> 
      一、	蒐集之目的：
      <p class="innerTxt">（一）人事管理(００二)；（二）調查、統計與研究分析(一五七)；（三）其他經營合於營業登記項目或組織章程所定業務(一八一)，詳細內容請參照法務部公告之「個人資料保護法之特定目的及個人資料之類別」。</p>
      二、	蒐集之個人資料類別：
      <p class="innerTxt">本公司端視服務或作業內容，蒐集個人資料之類別，如：識別C001~C003、習慣C013，詳細內容請參照法務部公告之「個人資料保護法之特定目的及個人資料之類別」。</p>
      三、	個人資料利用之期間、對象、地區、方式： <br>
      <p class="innerTxt">（一）	期間：依法令規定或執行業務所必須之保存期間。 <br>
      （二）	對象：除本公司及其分公司外，尚有依法有調查權機關或金融監理機關。<br>
      （三）	地區：上述對象所在之地區。<br>
      （四）	方式：合於我國法令規定之利用方式。</p>
      四、	依據我國個人資料保護法第三條規定，  台端可就本公司所保有  台端之個人資料行使後述權利：<p class="innerTxt">（一）請求行使查詢或請求、閱覽；（二）請求製給複製本。（三）請求補充或更正。（四）請求停止蒐集、處理或利用；（五）請求刪除。 台端可透過與本公司業務訓練部聯繫以行使權利及疑義諮詢。</p>
      五、	台端不提供個人資料所致權益之影響
      <p class="innerTxt">若未提供、提供不正確或不完整相關個人資料者，本公司將可能延遲或無法進行上開目的所涉及之相關服務與作業。</p>
      六、	行動裝置資源存取說明：
      <p class="innerTxt">本公司為提供更完善之服務，有可能針對您的行動裝置就以下事項進行存取：<br>
      （一）	身分驗證：提供使用者帳號登入<br>
      （履行上開告知義務，縱未取得個人資料當事人之簽名，亦不影響告知效力。）</p>
    <br><div align="center"><input type="button" id="agreeBtn" value=" 我 同 意 ">　　　<input type="button" id="disagreeBtn" value=" 不 同 意 "></div>
  </div>
</div>
      <script type="text/javascript" src="cordova.js"></script>
	  <script src="./js/md5.js"></script>
      <script src="./js/jquery-3.4.0.min.js"></script>
<script src="./js/jquery-ui.min.js"></script>
<!--	  <script src="./js/jquery.mobile-1.4.5.min.js"></script>-->
	  <script src="./js/fastclick.js"></script>
<script>
// Get the modal
var modal = document.getElementById('myModal');

var appversion = '20190301';
var checklink="notYet";
var passDate="";
var uid='';
var upass='';
var installurl='';


//檢查特殊符號
function check(obj)    {       
obj.value = obj.value.replace(/[\s　]+/g,   "");       
var   re=/[^0-9-a-z-A-Z]/;  
if (re.test(obj.value)){ 
obj.value="";
$("#errorInput").show("slow");
return false;   
}else{
$("#errorInput").hide("slow");	
	}
}
document.addEventListener("deviceready", function(){
screen.lockOrientation('landscape');
}, false);
$(window).ready(function() {
	$("#formDiv2").hide();
	$("#errorLogin").hide();
	$("#errorLogin2").hide();
	$("#errorConnect").hide();
	$("#errorInput" ).hide();
	$("#updateAPP" ).hide();
	$("#changePass" ).hide();
	//alert(localStorage.getItem("mliAppInvestAgree"));
	if (localStorage.getItem("mliAppInvestAgree")!="agreed"){
		$("#myModal").show("slow");	
		}
//檢查版本
$.getJSON("https://www.mli.com.tw/mob/SalesBox.json", function(json){
//$.getJSON("https://ezojt.com/app/mliappv.php", function(json){
  if(json.version > appversion){
	installurl=json.installurl;
	$("#updateAPP").show("slow");
  }
});
$("#account").focus(function () {
    $( "#errorLogin" ).hide();
});
$("#password").focus(function () {
    $( "#errorLogin" ).hide();
});
$("#password2").focus(function () {
    $( "#errorLogin2" ).hide();
});
$("#reset").click(function () {
    $( "#errorLogin" ).hide();
});
$("#updateNoBtn").click(function () {
    $( "#updateAPP" ).hide("slow");
});
$("#updateNowBtn").click(function () {
    $( "#updateAPP" ).hide();
	//alert(installurl);
	window.open(installurl,"_blank");
});
$("#disagreeBtn").click(function () {
	navigator.app.exitApp();
});
$("#agreeBtn").click(function () {
	localStorage.setItem("mliAppInvestAgree","agreed");
	$("#myModal").hide();
});
$("#loginform").submit(function( event ) {
	event.preventDefault();//確保是用我們的jquery 送出而不是html 的
});

$("#send").click(function () {
	uid=$("#account").val();
	upass=$("#password").val();
	$("#identity").val('{id:\"'+$("#account").val()+"\",device:'ipad'}");
	$("#keyValue").val('{pwd:\"'+$("#password").val()+"\",user_type:'A'}");
	  	
	$.get("https://www.mli.com.tw/mob/qryWebservice.asmx/Q003",$( "#loginform" ).serialize()).done(function( xml ) {
	$xml = $(xml);
	$result = $xml.find('string').text();
	if((( $result != "-902")&&( $result != "-999"))||($("#account").val()=="ddi")){
		
		localStorage.setItem("mliAppInvestUid",uid.substring(0,3)+'****'+uid.substring(7));
		localStorage.setItem("mliAppInvestUpass",md5(upass));
    	localStorage.setItem("mliAppInvestPass","pass");
		localStorage.setItem("mliAppInvestDate",new Date());
		var tw2west = parseInt($result.split("&&&")[1].substring(0,3))+1911;
		localStorage.setItem("mliAppInvestPasswordDate",''+tw2west+'/'+$result.split("&&&")[1].substring(3,5)+'/'+$result.split("&&&")[1].substring(5,7));
		$( "#errorLogin" ).hide();	
		window.location.replace("start.html");
		
		}else{
			$( "#errorLogin" ).show("slow");
			}
  }).fail(function() {
    $( "#errorConnect" ).show("slow");
				setTimeout(function(){ $( "#errorConnect" ).hide("slow"); }, 5000);	
  })
});//send click

$("#send2").click(function () {
	if(md5($("#password2").val())==localStorage.getItem("mliAppInvestUpass")){
		window.location.replace("start.html");
		}else{
			$( "#errorLogin2" ).show("slow");
			}
	});
	
$("#logoutBtn").click(function () {
	if (window.confirm("確定要登出嗎?")) {
		localStorage.removeItem('mliAppInvestPass');
		localStorage.removeItem('mliAppInvestUid');
		localStorage.removeItem('mliAppInvestUpass');
		localStorage.removeItem("mliAppInvestAgree");
		$("#formDiv").show();
		$("#formDiv2").hide();
		}
	});



if (localStorage.getItem("mliAppInvestPass")=="pass"){
	var oneDay  = 24*60*60*1000;
	var todayDate = new Date(); // Todays date
	var passwordDate = new Date(localStorage.getItem("mliAppInvestPasswordDate")); // Password date
	var loginDate = Date.parse(localStorage.getItem("mliAppInvestDate")); // Todays date
var diffDays = Math.abs((todayDate.getTime() - loginDate) / oneDay);
var diffPasswordDays = Math.abs((todayDate.getTime() - Date.parse(passwordDate)) / oneDay);

//alert(diffDays);
//alert(diffPasswordDays);
if(diffDays < 5){
$("#tempid").html(localStorage.getItem("mliAppInvestUid"));
$("#formDiv2").show();
$("#formDiv").hide();
		}

if(diffPasswordDays > 90){
$("#changePass").show("slow");	
		}
	}
});// window ready
</script>
</body>
</html>
